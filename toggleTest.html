<!DOCTYPE html>
<html lang="ko">
    <head>
        <title>üç¢ÏùºÏ†ï ÏôÑÎ£åÏó¨Î∂Ä Î≥ÄÍ≤Ω</title>

        <style>
            .todo-item {
                background-color: #fdfdfd;
            }
            .todo-item.completed {
                background-color: #d2ffd2;
            }
        </style>
    </head>

    <body>
        <main>
            <section class="add-todo-section">
                <form aria-label="ÏÉà ÏùºÏ†ï Ï∂îÍ∞Ä Ìèº" id="addTodoForm">
                    <input type="text" placeholder="ÏÉàÎ°úÏö¥ ÏùºÏ†ïÏùÑ Ï∂îÍ∞ÄÌïòÏÑ∏Ïöî" name="todo-item-title"/>
                    <button type="submit">Ï∂îÍ∞Ä</button>
                </form>
            </section>

            <hr>

            <section id="todoListSection" class="todo-list-section">
            </section>
        </main>

        <script>
            renderTodoList(selectTodoList());
            bindTest();
            
            function bindTest() {
                let todoItemArticleList = document.getElementsByClassName("todo-item");
                for (let i = 0; i < todoItemArticleList.length; i++) {
                    let todoInput = todoItemArticleList[i].getElementsByTagName("input")[0];
                    todoInput.onchange = function() {
                        toggleTodoComplete(todoInput.id);
                        renderTodoList(selectTodoList());
                        bindTest();
                    };
                }
            }

            // targetIdÏóê Ìï¥ÎãπÌïòÎäî ÏùºÏ†ïÏùò ÏôÑÎ£å Ïó¨Î∂ÄÎ•º ÌÜ†Í∏ÄÌïòÎäî Ìï®Ïàò
            function toggleTodoComplete(targetId) {
                // Î∞∞Ïó¥ Î≥ÄÏàò(todoList)Î•º ÏÉùÏÑ±ÌïòÍ≥†, selectTodoList Ìï®ÏàòÎ•º Ïù¥Ïö©Ìï¥ÏÑú (todoList)Ïóê ÌòÑÏû¨ Ï†ÄÏû•ÎêòÏñ¥ ÏûàÎäî ÏùºÏ†ï Î™©Î°ùÏùÑ Îã¥ÎäîÎã§.
                let todoList = selectTodoList();

                // (todoList)Ïùò ÏùºÏ†ï Îç∞Ïù¥ÌÑ∞ Ï§ëÏóêÏÑú id Í∞íÏù¥ Ìï®Ïàò ÌååÎùºÎØ∏ÌÑ∞Î°ú Ï†ÑÎã¨Î∞õÏùÄ (targetId)ÏôÄ ÎèôÏùºÌïú Îç∞Ïù¥ÌÑ∞Î•º ÌïÑÌÑ∞ÎßÅÌïú Í≤∞Í≥ºÍ∞í Ï§ë Ï≤´Î≤àÏß∏ Í∞íÏùÑ (targetTodoItem) Î≥ÄÏàòÏóê Îã¥ÎäîÎã§.
                let targetTodoItem = todoList.filter(function(todoItem) {
                    return todoItem.id == targetId;
                })[0];

                // (targetTodoItem)Ïù¥ undefinedÎùºÎ©¥ "Ìï¥Îãπ ÏùºÏ†ïÏù¥ Ï°¥Ïû¨ÌïòÏßÄ ÏïäÏäµÎãàÎã§." Î©îÏÑ∏ÏßÄ ÌëúÏãú ÌõÑ Ìï®Ïàò Ï¢ÖÎ£å
                if (targetTodoItem == undefined) {
                    alert("Ìï¥Îãπ ÏùºÏ†ïÏù¥ Ï°¥Ïû¨ÌïòÏßÄ ÏïäÏäµÎãàÎã§.");
                    return;
                }

                // (targetTodoItem) Í∞ùÏ≤¥Ïùò isCompleted Í∞íÏù¥ trueÏòÄÎã§Î©¥ falseÎ°ú, falseÏòÄÎã§Î©¥ trueÎ°ú Î≥ÄÍ≤ΩÌïúÎã§.
                if (targetTodoItem.isCompleted) {
                    targetTodoItem.isCompleted = false;
                } else {
                    targetTodoItem.isCompleted = true;
                }

                // (todoList) Î∞∞Ïó¥ÏùÑ JSON Î¨∏ÏûêÏó¥ ÌòïÏãùÏúºÎ°ú Î≥ÄÍ≤ΩÌïú Îí§ Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄÏóê Ï†ÄÏû•ÌïúÎã§.(Ïù¥Îïå, Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄ ÌÇ§ Í∞íÏùÄ "TODO_LIST_JSON"Î°ú ÏÇ¨Ïö©ÌïúÎã§)
                todoList = JSON.stringify(todoList);
                localStorage.setItem("TODO_LIST_JSON", todoList);
            }

            function selectTodoList() {
                // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóêÏÑú JSON ÌòïÏãùÏúºÎ°ú Ï†ÄÏû•ÎêòÏñ¥ ÏûàÎäî ÏùºÏ†ï Î™©Î°ù Îç∞Ïù¥ÌÑ∞Î•º Í∞ÄÏ†∏ÏôÄÏÑú (todoListJson) Î≥ÄÏàòÏóê Îã¥ÎäîÎã§.( Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄ ÌÇ§ : "TODO_LIST_JSON")
                let todoListJson = localStorage.getItem("TODO_LIST_JSON");
                
                // (todoListJson) Î≥ÄÏàò Í∞íÏù¥ nullÏù¥Í±∞ÎÇò undefinedÍ±∞ÎÇò Îπà Í∞íÏù¥ÎùºÎ©¥ (todoListJson) Î≥ÄÏàòÏóê Îπà Î∞∞Ïó¥ Î¨∏ÏûêÏó¥("[]")ÏùÑ Îã¥ÎäîÎã§.
                if (todoListJson == null || todoListJson == undefined || todoListJson == "") {
                    todoListJson = "[]";
                }

                // (todoListJson) Î≥ÄÏàò Í∞íÏùÑ ÏûêÎ∞îÏä§ÌÅ¨Î¶ΩÌä∏ Îç∞Ïù¥ÌÑ∞Î°ú Î≥ÄÌôòÌïòÏó¨ (todoList) Î≥ÄÏàòÏóê Îã¥ÎäîÎã§.
                let todoList = JSON.parse(todoListJson);

                // (todoList) Í∞íÏùÑ Î∞òÌôòÌïúÎã§.
                return todoList;
            }

            // ÌååÎùºÎØ∏ÌÑ∞Î°ú Ï†ÑÎã¨Î∞õÏùÄ ÏùºÏ†ï Î™©Î°ùÏùÑ ÌôîÎ©¥Ïóê UIÎ°ú ÌëúÏãúÌïòÎäî Ìï®Ïàò
            function renderTodoList(todoList) {
                // ÏùºÏ†ï Î™©Î°ùÏùÑ ÌëúÏãúÌï† ÏöîÏÜå(#todoListSection)Î•º Í∞ÄÏ†∏ÏôÄÏÑú (todoListSection) Î≥ÄÏàòÏóê Îã¥ÎäîÎã§.
                let todoListSection = document.getElementById("todoListSection");

                // (todoListSection) ÏöîÏÜåÏùò ÏûêÏãù ÏöîÏÜåÎì§ÏùÑ Î™®Îëê ÏÇ≠Ï†úÌïúÎã§.
                todoListSection.innerHTML = "";

                // ÌååÎùºÎØ∏ÌÑ∞Î°ú Î∞õÏùÄ (todoList) Îç∞Ïù¥ÌÑ∞Î•º ÏàúÌöåÌïúÎã§. Ïù¥Îïå, Ïù∏Îç±Ïä§ Î≥ÄÏàò (i)Î•º ÏÉùÏÑ±ÌïòÏó¨ ÏàúÌöåÌïúÎã§.
                for (let i = 0;i < todoList.length; i++) {
                    // (todoList) Îç∞Ïù¥ÌÑ∞ Ï§ë (i)Î≤àÏß∏ ÏùºÏ†ï Îç∞Ïù¥ÌÑ∞Î•º (todoItem) Î≥ÄÏàòÏóê Îã¥ÎäîÎã§.
                    let todoItem = todoList[i];

                    // (todoItem) Í∞ùÏ≤¥Ïùò id Í∞íÏùÑ (todoItemId) Î≥ÄÏàòÏóê Îã¥ÎäîÎã§.
                    let todoItemId = todoItem.id;

                    // (todoItem) Í∞ùÏ≤¥Ïùò title Í∞íÏùÑ (todoItemTitle) Î≥ÄÏàòÏóê Îã¥ÎäîÎã§.
                    let todoItemTitle = todoItem.title;

                    // (todoItem) Í∞ùÏ≤¥Ïùò isCompleted Í∞íÏùÑ (isTodoItemCompleted) Î≥ÄÏàòÏóê Îã¥ÎäîÎã§.
                    let isTodoItemCompleted = todoItem.isCompleted;

                    // (todoItemTitle), (isTodoItemCompleted), (todoItemId) Î≥ÄÏàòÎì§ÏùÑ Ïù¥Ïö©ÌïòÏó¨ (i)Î≤àÏß∏ ÏùºÏ†ï Îç∞Ïù¥ÌÑ∞Î•º ÌôîÎ©¥Ïóê Í∑∏Î¶∞Îã§.
                    todoListSection.innerHTML += `
                        <article class="todo-item ${isTodoItemCompleted ? 'completed' : ''}">
                            <div class="checkbox-wrapper">
                                <input type="checkbox" id="${todoItemId}" ${isTodoItemCompleted ? 'checked' : ''}/>
                                <label for="${todoItemId}">${todoItemTitle}</label>
                            </div>
                            <button type="button" class="delete-btn">ÏÇ≠Ï†ú</button>
                        </article>
                    `;
                }
            }
        </script>
    </body>
</html>
